var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,a=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&i(e,n,t[n]);if(r)for(var n of r(t))o.call(t,n)&&i(e,n,t[n]);return e},c=(e,r)=>t(e,n(r)),l=(e,t)=>{var n={};for(var i in e)s.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&r)for(var i of r(e))t.indexOf(i)<0&&o.call(e,i)&&(n[i]=e[i]);return n};import{v as u,n as h,e as d,S as m,C as p,u as g,l as f,a as w,R as y,r as v,L as b,f as E,m as k,b as $,d as x,O as C,c as S,i as N,g as A,h as T,j as R,k as O,B as P}from"./vendor.e091920f.js";const j=navigator.userAgent||navigator.vendor||window.opera,I=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(j)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(j.substr(0,4)),L=(e,t)=>e.w===t.w&&e.h===t.h,D=(e,t)=>e.w===t.w&&e.h>t.h,q={w:window.innerWidth,h:window.innerHeight};let F={w:window.innerWidth,h:window.innerHeight},M={w:window.innerWidth,h:window.innerHeight},U=!1;const H=d(),z=H.subscribe;function _(e){U!==e&&(U=e,H(e))}I&&window.addEventListener("resize",(()=>{F=M,M={w:window.innerWidth,h:window.innerHeight},(L(M,q)&&D(M,F)||L(F,q)&&D(F,M))&&_(!1)}));const G=new Set;let W=!1;const B=d(),V=B.subscribe;function J(e){const t=function(){const e={};return G.add(e),K(),()=>{G.delete(e),K()}}();return e.finally(t)}function K(){const e=Boolean(G.size);e!==W&&(W=e,B(e))}function Q(e,t={}){const n="body"in t&&"string"!=typeof t.body?JSON.stringify(t.body):t.body,r=c(a({},t),{body:n});return J(fetch(e,r).then((e=>Promise.all([e,e.text()]))).then((([t,n])=>(function(e,t,n){const r=Math.floor(e/100);let s=Z[e];if(console.debug(`HTTP[${e} ${s}]: ${t}`),r<4)return;s||(4===r?s="Unknown client error":5===r&&(s="Unknown server error"));throw new Y(e,s||"Unknown status",n)}(t.status,e,n),function(e){const t=e.headers.get("content-type");return!!t&&t.toLowerCase().includes("application/json")}(t)?JSON.parse(n):n))))}const X=(e,t=null,n={})=>Q(e,a({method:"POST",body:t},n));class Y extends Error{constructor(e,t,n){super(`${e}: ${t}`),this.status=e,this.body=n}}const Z={100:"Continue",101:"Switching Protocol",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"unused",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};function ee(e){const t=`https://api.github.com${e}`,n=`p=${Date.now()}`;return t.includes("?")?`${t}&${n}`:`${t}?${n}`}function te(e){return{Authorization:`token ${e}`}}class ne{constructor(e){this.token=e}send(e,t){const n={query:this.buildQuery(e,t),variables:t},r=te(this.token);return X(ee("/graphql"),n,{headers:r}).then((e=>{const{errors:t}=e;return t&&console.error("GraphQL errors:",t),e}))}buildQuery(e,t){const n=Object.keys(t);if(!n.length)return`query {${e}}`;return`query(${n.map((e=>`$${e}: String!`)).join(", ")}) {${e}}`}}var re,se;(se=re||(re={})).Json="application/vnd.github.v3+json",se.Raw="application/vnd.github.v3.raw",se.Html="application/vnd.github.v3.html";class oe{constructor(e){this.token=e}GET(e,t){return((e,t={})=>Q(e,t))(ee(e),this.withAuth(t))}DELETE(e){return((e,t={})=>Q(e,a({method:"DELETE"},t)))(ee(e),this.withAuth())}PUT(e,t){return((e,t=null,n={})=>Q(e,a({method:"PUT",body:t},n)))(ee(e),t,this.withAuth())}POST(e,t){return X(ee(e),t,this.withAuth())}PATCH(e,t){return((e,t=null,n={})=>Q(e,a({method:"PATCH",body:t},n)))(ee(e),t,this.withAuth())}withAuth({mediaType:e=re.Json}={}){return{headers:c(a({},te(this.token)),{Accept:e})}}}const ie={has_issues:!1,has_projects:!1,has_wiki:!1,auto_init:!0,allow_merge_commit:!0,allow_squash_merge:!1,allow_rebase_merge:!1,delete_branch_on_merge:!1,has_downloads:!1,is_template:!1};class ae{constructor(e,t,n){this.token=e,this.owner=t,this.name=n,this.commiting=!1,this.branch="main",this.rest=new oe(e),this.gql=new ne(e)}get url(){return`/repos/${this.owner}/${this.name}`}get isCommiting(){return this.commiting}exists(){return this.rest.GET(this.url).then((()=>!0),(()=>!1))}async create(e,t){try{await this.rest.POST("/user/repos",a({name:this.name,description:e,homepage:"",private:t,visibility:t?"private":"public"},ie))}catch(n){throw console.error(n),n}}async createIfNecessary(e,t){return!(await this.exists())&&(await this.create(e,t),!0)}async readDir(e){const t=e.replace(/^\*|\*$/g,""),{data:{repository:{files:n}}}=await this.gql.send("\n    repository(owner: $owner, name: $repo) {\n      files: object(expression: $path) {\n        ... on Tree {\n          entries {\n            path\n            object {\n              ... on Blob {\n                text\n              }\n            }\n          }\n        }\n      }\n    }\n  ",this.getFileVars(t));return n?n.entries.map((e=>[e.path,e.object.text])):[]}async getReadme(){return this.rest.GET(`${this.url}/readme`,{mediaType:re.Raw})}async readFile(e){const t=await this.rest.GET(`${this.url}/contents/${e}`,{mediaType:re.Raw});if(Array.isArray(t))throw new Error(`${this.url}/${e} is a directory`);return t}async writeFile(e,t,n){await this.rest.PUT(`${this.url}/contents/${e}`,{message:n,content:t})}commit(e,t,n=!1){const{owner:r,name:s,branch:o,token:i}=this,a={token:i,owner:r,repo:s,branch:o,files:t,message:e};return this.commiting=!0,X("https://pensieve.amatiasq.com/commit",a,{keepalive:n}).finally((()=>this.commiting=!1))}async readFileCool(e,t){return this.gql.send(function(e){return`\n    repository(owner: $owner, name: $repo) {\n      object(expression: $path) {\n        ... on Blob {\n          ${e}\n        }\n      }\n    }\n  `}(t),this.getFileVars(e)).then((e=>{var t;return null==(t=e.data.repository.file)?void 0:t.text}))}getFileVars(e){return{owner:this.owner,repo:this.name,path:`${this.branch}:${e}`}}}let ce=0;const le=Boolean(localStorage.getItem("debug"));function ue(e,t,n){if(!le)return;const r=e.constructor.name;t.forEach((t=>{const s=e[t];e[t]=(...o)=>{const i="  ".repeat(ce++),a=n?` [${n}]`:"";console.debug(`${i}🟢 ${r}.${t}${a}`,o[0]);const c=s.apply(e,o);return console.debug(`${i}🔴 ${r}.${t}${a}`),ce--,c}}))}class he{constructor(e){this.duration=e,this.data=new Map,this.time=new Map}has(e){const t=this.time.get(e);if(null==t)return!1;const n=(Date.now()-t)/1e3>this.duration;return n&&(this.time.delete(e),this.data.delete(e)),!n}get(e){return this.data.get(e)}set(e,t){this.time.set(e,Date.now()),this.data.set(e,t)}}class de{constructor(e,t,n){this.store=e,this.seconds=t,this.readAllCache=new he(this.seconds),this.cache=new he(this.seconds),ue(this,["readAll","read","write","delete"],n)}has(e){return this.store.has(e)}readAll(e){if(this.readAllCache.has(e))return this.readAllCache.get(e);const t=this.store.readAll(e);return this.readAllCache.set(e,t),t}read(e){if(this.cache.has(e))return this.cache.get(e);const t=this.store.read(e);return this.cache.set(e,t),t}write(e,t,n){return this.cache.set(e,Promise.resolve(t)),this.store.write(e,t,n)}delete(e,t){return this.cache.set(e,Promise.resolve(null)),this.store.delete(e,t)}}class me{constructor(e){this.forage=e,this.keys=null,ue(this,["readAll","read","write","delete"])}async has(e){const t=this.keys||await this.forage.keys();return this.keys||(this.keys=t,setTimeout((()=>this.keys=null),3e3)),t.includes(e)}async readAll(e){const t=function(e){const t=e.startsWith("*")?"":"^",n=e.endsWith("*")?"":"$",r=e.replace(/^\*|\*$/g,"");return new RegExp(`${t}${r}${n}`)}(e),n=(await this.forage.keys()).filter((e=>t.test(e))).map((async e=>[e,await this.read(e)])),r=(await Promise.all(n)).filter((e=>e[1]));return Object.fromEntries(r)}read(e){return this.forage.getItem(e)}async write(e,t){await this.forage.setItem(e,t)}async delete(e){await this.forage.removeItem(e)}}function pe(e,t){return{urgent:e&&e.urgent||!1,reason:e&&e.reason||t}}class ge{constructor(e){this.repo=e,this.scheduler=new m(100,(()=>this.push())),this.pending=[],ue(this,["readAll","read","write","delete"])}has(e){throw new Error("Do not use me")}async readAll(e){const t=await this.repo.readDir(e);return Object.fromEntries(t)}read(e){return this.repo.readFile(e)}write(e,t,n){const{urgent:r,reason:s}=pe(n,`Update ${e}`);return this.commit(s,{[e]:t},r)}async delete(e,t){const{urgent:n,reason:r}=pe(t,`Remove ${e}`);await this.commit(r,{[e]:null},n)}commit(e,t,n){if(!Object.keys(t).length)throw new Error("NO FILES TO COMMIT");return new Promise(((r,s)=>{this.pending.push({message:e,files:t,resolve:r,reject:s}),n?this.push(!0):this.scheduler.restart()}))}push(e=!1){if(this.repo.isCommiting)return void this.scheduler.restart();if(!this.pending.length)return;const t=[...this.pending];this.pending.length=0;const n=t.reduce(((e,t)=>a(a({},e),t.files)),{}),r=(s=t.map((e=>e.message)),Array.from(new Set(s)));var s;const o=r.length>1?`Multiple:\n- ${r.join("\n- ")}`:r[0];this.repo.commit(o,n,e).then((()=>t.forEach((e=>e.resolve()))),(e=>t.forEach((t=>t.reject(e)))))}}class fe{constructor(e,t){this.local=e,this.remote=t,ue(this,["readAll","read","write","delete"])}has(e){throw new Error("Do not use me")}localHas(e){return this.local.has(e)}readAll(e){return this.readAllRemote(e).catch((()=>this.readAllLocal(e)))}async readAllRemote(e){const[t,n]=await Promise.all([this.local.readAll(e),this.remote.readAll(e)]),r=Object.keys(t).filter((e=>!(e in n))).map((e=>this.local.delete(e))),s=Object.keys(n).filter((e=>n[e]!==t[e])).map((e=>this.local.write(e,n[e])));return Promise.all(s).then((()=>console.log(`${r.length} notes removed from local and ${s.length} updated`))),n}readAllLocal(e){return this.local.readAll(e)}read(e){return this.remote.read(e).then((t=>this.updateOffline(e,t)),(()=>this.local.read(e)))}readRemote(e){return this.remote.read(e).then((t=>this.updateOffline(e,t)))}readLocal(e){return this.local.read(e)}async write(e,t,n){await Promise.race([this.local.write(e,t,n),this.remote.write(e,t,n)])}async delete(e,t){await Promise.race([this.local.delete(e,t),this.remote.delete(e,t)])}deleteLocal(e){this.local.delete(e)}updateOffline(e,t){return null==t?this.local.delete(e):this.local.write(e,t),t}}class we extends Error{}const ye=new p("pensieve.pending-commands",{default:[]}),ve=e=>ye.set([...ye.cache,e]);class be{constructor(e){this.remote=e,this.reading=new Map,this.reconnect=new m(1e3,(()=>this.executePending())),window.addEventListener("online",(()=>this.executePending())),ue(this,["readAll","read","write","delete"])}get isOffline(){return!navigator.onLine}has(e){throw new Error("Do not use me")}readAll(e){return this.rejectIfOffline()||this.remote.readAll(e)}read(e){if(this.reading.has(e))return this.reading.get(e);if(this.isOffline)return Promise.reject((()=>new we));const t=this.remote.read(e);return this.reading.set(e,t),t.finally((()=>this.reading.delete(e)))}write(e,t,n){return this.command("write",[e,t,n])}delete(e,t){return this.command("delete",[e,t])}rejectIfOffline(){if(this.isOffline)return Promise.reject(new we)}command(e,t,n=0){if(this.isOffline)return ve({method:e,params:t,attempts:n}),Promise.reject(new we);return this.remote[e](...t).catch((r=>{throw ve({method:e,params:t,attempts:n+1}),this.reconnect.restart(),r}))}executePending(){if(this.isOffline)this.reconnect.restart();else for(const{method:e,params:t,attempts:n}of(()=>{const e=[...ye.cache];return ye.reset(),e})())n<5?this.command(e,t,n):console.warn(`Command ${e} failed ${n} times`,...t)}}const Ee={},ke=g.v4();function $e(e){const t=d();Ee[e]=t;return[t=>{setTimeout((()=>postMessage({id:ke,type:e,data:t},location.origin)),10)},t.subscribe]}function xe(e){return JSON.stringify(e,null,2)}function Ce(e){const t=e.replace(/[^:]\/\/[^\n]+\n/g,"");try{return JSON.parse(t)}catch(n){const[e]=n.message.split(/\s/g).reverse();throw console.warn(`Error in JSON (${n.message}):\n${t.substr(e-100,200)}`),n}}function Se(e=new Date){return`${e.getFullYear()}-${Ae(e.getMonth()+1)}-${Ae(e.getDate())} ${Ae(e.getHours())}:${Ae(e.getMinutes())}:${Ae(e.getSeconds())}`}function Ne(e){return new Date(e)}function Ae(e){return e<10?`0${e}`:`${e}`}function Te(e,t){return(null!=e&&null!=t||e===t)&&xe(e)===xe(t)}function Re(e){const t=e.trim(),n=t.indexOf("\n"),r=-1===n?t:t.substr(0,n),s=function(e){const t=e.match(/(\.\w+)+$/);return t?t[0]:".md"}(r),o=function(e,t){const n=function(e){const t=function(e){return{".sql":"--",".md":"#",".sh":"#",".js":"//",".ts":"//",".cs":"//",".fs":"//"}[e]||"//"}(e);return new RegExp(`^\\s*(${t})+`)}(t);return e.trim().replace(n,"").trim()}(r,s),[i,a]=o.split("/").reverse().map((e=>e.trim()));return{title:i,group:a,extension:s,content:e}}window.addEventListener("message",(e=>{const t=Ee[e.data.type];"function"==typeof t&&(console.debug(`🚎 ${e.data.type}`,e.data.data),t(e.data.data))}));const Oe={autosave:5,reloadIfAwayForSeconds:5,renderIndentGuides:!1,rulers:[],sidebarVisible:!0,sidebarWidth:400,starNewNotes:!0,tabSize:2,wordWrap:!0};function Pe(e,t){return xe(e)===xe(t)}const je={"CTRL+TAB":"goBack","CTRL+SHIFT+TAB":"goForward","ALT+N":"toggleWordWrap","CMD+S":"save","CMD+,":"settings","CMD+B":"hideSidebar","CMD+W":"goHome","CMD+N":"newNote","CMD+SHIFT+E":"clearFilter","CTRL+S":"save","CTRl+,":"settings","CTRL+B":"hideSidebar","CTRL+W":"goHome","CTRL+N":"newNote"};function Ie(e,t,n,r=(()=>!0)){let s=!1,o=!1;return new Promise(((i,a)=>{t.finally((()=>o=!0)).then((e=>{s?n(e):i(e)}),(e=>{s&&a(e)})),e.then((e=>{r(e)&&(s=!0,i(e))}),(e=>{s=!0,o&&a(e)}))}))}class Le{constructor(e,t,n){this.store=e,this.key=t,this.defaultValue=n}get isCached(){return this.store.localHas(this.key)}read(){return this.store.read(this.key).then((e=>e||this.defaultValue),(()=>this.defaultValue))}readAsap(e){const t=e=>e||this.defaultValue;return Ie(this.store.readLocal(this.key).then(t),this.store.readRemote(this.key).then(t),e)}write(e,t){const n=pe(t,`Write ${this.key}`);return this.store.write(this.key,e,n)}delete(e){const t=pe(e,`Delete ${this.key}`);return this.store.delete(this.key,t)}}class De extends Le{constructor(e,t,n){super(e,t,xe(n)),this.defaultJson=n;const[r,s]=$e(`json:changed:${t}`);this.emitChange=r,this.onChange=s}get(){return this.read().then((e=>e?Ce(e):this.defaultJson)).catch((()=>this.defaultJson))}set(e,t){const n=xe(e),r=pe(t,`Set ${this.key}`);return this.write(n,r)}async write(e,t){this.emitChange(Ce(e)),await super.write(e,t)}}const qe=()=>{},Fe=new Map;class Me{constructor(e,t,n){this.id=e,this.meta=t,this.content=n;const[r,s]=$e(`note:title:${e}`),[o,i]=$e(`note:deleted:${e}`),[a,c]=$e(`note:changed:${e}`),[l,u]=$e(`note:content-changed:${e}`);if(Fe.has(e))throw new Error(`Created RemoteNote twice with same id: ${e}`);this.emitChange=a,this.emitContentChange=l,this.emitDelete=o,this.emitDraft=r,this.onChange=c,this.onContentChange=u,this.onDelete=i,this.onDraft=s}get title(){const e=this.get();return e?e.title:"(unknown)"}get hasCachedContent(){return Promise.resolve(!0)}getCache(){return Fe.get(this.id)||null}get(){return this.getCache()}async delete(e){const t=pe(e,`Delete note "${this.title}"`);await Promise.all([this.meta.delete(t).catch(qe),this.content.delete(t).catch(qe)]),this.emitDelete()}draft(e){const t=this.getCache();if(!t)return;const{title:n,group:r}=Re(e);this.emitDraft(c(a({},t),{title:n,group:r}))}async read(){localStorage.getItem("URGENT_SAVE")===this.id&&(localStorage.removeItem("URGENT_SAVE"),await new Promise((e=>setTimeout(e,500))));const e=await this.content.readAsap((e=>{this.updateFromContent(e),this.emitContentChange(e)}));return e&&this.updateFromContent(e),e}async write(e,t){t&&t.urgent&&localStorage.setItem("URGENT_SAVE",this.id);const{title:n}=Re(e),r=pe(t,`Update note "${this.title}"${n!==this.title?` renamed "${n}"`:""}`);await Promise.all([this.updateFromContent(e,r),this.content.write(e,r)]),this.emitContentChange(e)}setGroup(e,t){const n=pe(t,`Add note to group "${e}"`);return this.update((t=>c(a({},t),{group:e})),n)}toggleFavorite(e){const t=pe(e,`Toggle "${this.title}" favorite`);return this.update((e=>c(a({},e),{favorite:!e.favorite})),t)}async push(e){const{id:t}=this;if(e.id!==t)throw new Error(`Pushing note with id ${e.id} into RemoteNote with id ${t}`);const n=!Te(this.getCache(),e);Fe.set(t,e),n&&this.emitChange(e)}async update(e,t){const n=await this.meta.get(),r=e(n),s=Se();return Te(c(a({},n),{modified:s}),c(a({},r),{modified:s}))||(await this.meta.set(r,t),this.emitChange(r)),r}async updateFromContent(e,t){const{title:n,group:r}=Re(e),s=await this.update((e=>c(a({},e),{title:n,group:r,modified:Se()})),t);return Fe.set(this.id,s),s}}const Ue=e=>`meta/${e}.json`,He=e=>`note/${e}`,ze=e=>e.trim().replace(/,$/,"");class _e{constructor(e){this.store=e,this.notes=new Map,this.settings=new De(this.store,"settings.json",Oe),this.shortcuts=new De(this.store,"shortcuts.json",je);const[t,n]=$e("notes-created");this.emitNotesCreate=t,this.onNotesCreated=n}async all(){const e="meta/*",t=e=>t=>(console.log(`Notes found in ${e}`,Object.keys(t).length),t);return Ie(this.store.readAllLocal(e).then(t("local")),this.store.readAllRemote(e).then(t("remote")),(e=>this.synchronize(e)),(e=>Boolean(Object.keys(e).length))).then((e=>Object.values(e).map((e=>{const t=Ce(ze(e));return this.updateRemote(t.id,t),t}))))}synchronize(e){const t=[],n=new Set(...this.notes.keys());for(const[,r]of Object.entries(e)){const e=Ce(ze(r)),s=n.delete(e.id);this.note(e.id).push(e),s||t.push(e)}t.length&&this.emitNotesCreate(t);for(const r of n)this.store.deleteLocal(Ue(r)),this.store.deleteLocal(He(r))}note(e){return this.notes.has(e)?this.notes.get(e):this.createRemote(e,c(a({},Ge("")),{id:e}))}create(e){const t=Ge(e),{id:n}=t,r=this.createRemote(n,t),s=`Create note "${t.title}"`;return Promise.all([this.store.write(Ue(n),xe(t),{reason:s}),r.write(e,{reason:s})]),this.emitNotesCreate([t]),r}updateRemote(e,t){if(!this.notes.get(e))return this.createRemote(e,t);const n=this.notes.get(e);return n.push(t),n}createRemote(e,t){const n=new Me(e,new De(this.store,Ue(e),t),new Le(this.store,He(e),""));return this.notes.set(e,n),n.push(t),n}}function Ge(e){const{group:t,title:n}=Re(e);return{id:g.v4(),title:n,group:t,favorite:!0,created:Se(),modified:Se()}}Object.assign(window,{localforage:f});class We{constructor(e,t){this.history=e,this.path=t,this.root="/",this.create="/new",this.settings="/settings",this.note="/note/:noteId",this.goRoot=()=>this.history.push(this.root),this.goSettings=()=>this.history.push(this.settings),this.toNote=Ve((e=>this.note.replace(":noteId",e))),this.goNote=Ve((e=>this.history.push(this.note.replace(":noteId",e)))),this.isNote=Ve((e=>this.path===this.note.replace(":noteId",e)))}onNavigate(e){return this.history.listen((t=>e(new We(this.history,t.pathname))))}getPageName(){if("/"===this.path)return"home";const[,e]=this.path.split("/");return e}}function Be(){const e=w();return new We(e,e.location.pathname)}function Ve(e){return t=>e("string"==typeof t?t:t.id)}function Je(){return y.createElement("div",{className:"loader"},y.createElement("div",{className:"container"},y.createElement("div",{className:"ripple"}),y.createElement("div",{className:"ripple ripple2"})))}const Ke=v.exports.createContext(null);function Qe(){return v.exports.useContext(Ke)}function Xe(){const e=Qe(),t=Be();return()=>{const n=e.create(`${Se()}.md\n`);t.goNote(n.id)}}let Ye=0;function Ze(){const e=Qe(),[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState([]);return v.exports.useEffect((()=>{t||n(!0),e.all().then(o)}),[]),v.exports.useEffect((()=>{const t=r.map((t=>e.note(t.id))),n=[e.onNotesCreated(i),...t.map((e=>e.onChange(a))),...t.map((e=>{return e.onDelete((t=e.id,()=>{s(r.filter((e=>e.id!==t)))}));var t}))];return()=>n.forEach((e=>e()))}),[r]),[r,t];function o(e){if(i=e,(o=r).length!==i.length||!o.every(((e,t)=>Te(e,i[t])))){const t=e.sort(((e,t)=>Number(Ne(t.created))-Number(Ne(e.created))));s(t)}var o,i;t&&n(!1)}function i(e){const t=e.map((e=>e.id)),n=r.filter((e=>!t.includes(e.id)));o([...e,...n])}function a(e){const{id:t}=e,n=r.findIndex((e=>e.id===t));if(-1===n)throw new Error(`Unknown note updated: ${t}`);o([...r.slice(0,n),e,...r.slice(n+1)])}}const et=new p("pensieve.settings-hook",{version:1});function tt(e){const[t,n,r]=function(){const e=Qe(),[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState(et.cache||Oe);return v.exports.useEffect((()=>(e.settings.get().then(o),e.settings.onChange(o))),[]),[r,async function(t){Pe(t,r)||(et.set(t),n(!0),s(t),await e.settings.set(t),n(!1))},{loading:t}];function o(e){Pe(e,r)||(et.set(e),s(e)),t&&n(!1)}}(),s=t[e],[,o]=v.exports.useState(s);return v.exports.useEffect((()=>{o(s);const t="boolean"!=typeof s?s:s?1:0;document.documentElement.style.setProperty(`--setting-${e}`,`${t}`)}),[xe(s)]),[s,function(r){xe(s)!==xe(r)&&n(c(a({},t),{[e]:r}))},r]}et.get();const nt={Meta:"META",Shift:"SHIFT",Alt:"ALT",Control:"CTRL"},rt={" ":"Space"},st=d(),ot=st.subscribe;I||document.addEventListener("keydown",(function(e){const t=[];e.metaKey&&t.push("META");e.ctrlKey&&t.push("CTRL");e.altKey&&t.push("ALT");e.shiftKey&&t.push("SHIFT");if(e.key in nt)return;const n=function(e){return e in rt?rt[e]:e}(e.key);st({key:e.key,keys:[...t.sort(),n],preventDefault:()=>e.preventDefault()})}),!0);const it={};let at=!1;function ct(e,t){const n=it[e],r=Qe();v.exports.useEffect((()=>(it[e]=t,()=>{it[e]=n}))),at||function(e){let t=lt(je);const n=e=>t=lt(e);e.shortcuts.get().then(n),e.shortcuts.onChange(n),ot((e=>{const n=e.keys.join("+").toUpperCase();if(e.keys.length>1&&console.log(n),n in t){const r=t[n],s=it[r]||null;console.log("Shortcut received",{keys:n,commandName:r,command:s}),"function"==typeof s&&(e.preventDefault(),s())}})),at=!0}(r)}function lt(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>{return[(n=e,n.toUpperCase().replace(/CMD|WINDOWS|WIN/,"META")),t];var n})))}function ut(e){return y.createElement("button",a({type:"button",role:"button"},e))}function ht({name:e,prefix:t="fas",className:n}){const[r,s]=e.includes(" ")?e.split(" "):[t,e];return y.createElement("i",{className:`${r} fa-${s} ${n||""}`})}function dt(e){const t=e,{icon:n,className:r}=t,s=l(t,["icon","className"]),o=`icon-button ${r||""}`;return y.createElement(ut,c(a({},s),{className:o}),y.createElement(ht,{name:n}))}function mt(e){const[t,n]=v.exports.useState(!1),[r,s]=v.exports.useState(e.size),[o,i]=v.exports.useState([0,0]);return y.createElement("div",{className:"resizer",draggable:!0,onDragStart:e=>{n(!0),s(e.clientX),i([0,0])},onDrag:e=>{t&&i([o[1],e.clientX-r])},onDragEnd:()=>{const t=r+o[0];n(!1),s(t),e.onChange(t)}})}function pt(e,t){const[n]=v.exports.useState({callback:t}),[r]=v.exports.useState(new m(e,(()=>n.callback())));return n.callback=t,r}const gt=/\s+/g;class ft{constructor(e){this.clean=wt(e)}fullMatch(e){return wt(e)===this.clean}matches(e){return!this.clean||wt(e).includes(this.clean)}matchesAny(e){return e.filter(Boolean).some((e=>this.matches(e)))}}function wt(e){return e.toLowerCase().replace(gt,"")}function yt({onChange:e}){const t=v.exports.createRef(),[n,r]=v.exports.useState(""),s=pt(50,(()=>e(n?new ft(n):null)));return ct("clearFilter",(()=>o(""))),y.createElement(y.Fragment,null,y.createElement("input",{ref:t,className:"filter-box",type:"text",placeholder:"Filter...",defaultValue:n,onChange:e=>o(e.target.value)}),n?y.createElement(dt,{icon:"times",onClick:()=>o("")}):null);function o(e){t.current&&(t.current.value=e),r(e),s.restart()}}function vt(e){const t=Qe(),n=t.note(e),[r,s]=v.exports.useState(n.get()),[o,i]=v.exports.useState(!r);return v.exports.useEffect((()=>{const e=n.get();e?a(e):i(!0);const t=[n.onChange(a),n.onDraft(a)];return()=>t.forEach((e=>e()))}),[e]),[r,{loading:o,toggleFavorite:()=>t.note(e).toggleFavorite(),remove:()=>t.note(e).delete(),draft:n=>t.note(e).draft(n)}];function a(e){Te(e,r)||s(e),o&&i(!1)}}function bt({id:e}){const t=Be(),[n,{toggleFavorite:r,remove:s}]=vt(e),[o,i]=v.exports.useState(t.isNote(e));if(v.exports.useEffect((()=>t.onNavigate((t=>{const n=t.isNote(e);(o||n)&&i(n)})))),!n)return null;const l=["note-item",n.favorite?"favorite":"",o?"active":""],u=n.group?{"data-group":n.group}:{};return y.createElement(b,c(a({className:l.join(" ")},u),{to:t.toNote(n)}),y.createElement("div",{className:"star-part"},y.createElement(dt,{icon:n.favorite?"star":"far star",onClick:function(e){e.preventDefault(),r()}})),y.createElement("h5",{className:"title-part"},n.title),y.createElement("div",{className:"actions-part"},y.createElement("a",{href:`https://github.com/amatiasq/pensieve-data/blob/main/note/${n.id}`},"GH"),y.createElement(dt,{icon:"trash",onClick:function(r){if(!confirm(`Delete ${n.title}?`))return;r.preventDefault(),t.isNote(e)&&t.goRoot();return s()}})))}const Et=e=>`group-open:${e}`;function kt({group:e,notes:t}){const n=e=>t.some((t=>e.isNote(t))),r=(e=>Boolean(localStorage[Et(e)]))(e),s=Be(),[o,i]=v.exports.useState(n(s));v.exports.useEffect((()=>s.onNavigate((e=>{const t=n(e);o!==t&&i(t)}))));const a=t.filter((e=>e.favorite)),c=["group",o?"has-active":"",a.length?"has-favorite":""];return y.createElement("details",{className:c.join(" "),"data-group":e,open:r},y.createElement("summary",{className:"group-title",onClick:$t},y.createElement(ht,{name:"angle-right",className:"icon-button group-caret"}),y.createElement("span",{className:"group-name"},e),a.length?y.createElement(y.Fragment,null,y.createElement("i",{className:"fav-counter"},a.length)," /"):null,y.createElement("i",{className:"counter"},t.length)),y.createElement("ul",{className:"group-content"},t.map((e=>y.createElement(bt,{key:e.id,id:e.id})))))}function $t(e){const t=e.currentTarget.parentElement,n=t.hasAttribute("open"),r=Et(t.dataset.group);console.log(`${r}: ${!n}`),n?localStorage.removeItem(r):localStorage.setItem(r,"true")}function xt(){const e=Xe(),[t,n]=Ze(),[r,s]=v.exports.useState(null),o=function(e,t){const[n,r]=v.exports.useState([]),[s,o]=v.exports.useState(0),i=Qe();if(v.exports.useEffect((()=>{t&&(o(0),r(e.filter((e=>t.matchesAny([e.id,e.title,e.group])))))}),[e,t]),!t)return e;const a=++Ye;return setTimeout((async function(){if(a===Ye)for(let a=s;a<e.length;a++){const s=e[a];if(n.includes(s))continue;const c=i.note(s.id);if(await c.hasCachedContent){const e=await c.read();if(t.matches(e)){o(a+1),r([...n,s]);break}}}}),10),n}(t,r),[i,c]=tt("sidebarVisible"),[l,u]=tt("sidebarWidth");if(ct("newNote",e),ct("hideSidebar",(()=>c(!i))),!i)return null;const h=r?{"data-filter":!0}:{};return y.createElement("aside",null,y.createElement("h4",{className:"filter"},y.createElement(yt,{onChange:s}),y.createElement(dt,{icon:"plus",onClick:e})),y.createElement("div",a({className:"notes-list"},h),n?y.createElement(Je,null):function(){const e=new Map,t=[...o.filter((e=>e.favorite)),...o.filter((e=>!e.favorite))];return t.map((t=>{var n;const{group:r}=t;return r?e.has(r)?(null==(n=e.get(r))||n.push(t),null):(e.set(r,[t]),r):t})).filter(Boolean).map((t=>{if("string"!=typeof t)return y.createElement(bt,{key:t.id,id:t.id});const n=t,r=e.get(n);return y.createElement(kt,{key:`group/${n}`,group:n,notes:r})}))}()),y.createElement(mt,{size:l,onChange:u}))}function Ct(){const e=Xe();return v.exports.useEffect(e,[]),y.createElement(Je,null)}const{isHidden:St,visibilitychange:Nt}=function(){null==document.addEventListener&&It("Page Visibility API");if(null!=document.hidden)return{isHidden:"hidden",visibilitychange:"visibilitychange"};if(null!=document.msHidden)return{isHidden:"msHidden",visibilitychange:"msvisibilitychange"};if(null!=document.webkitHidden)return{isHidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"};It("Page Visibility API")}(),At=E(window,"pageshow"),Tt=E(window,"pagehide"),Rt=E(window,"freeze"),Ot=E(window,"resume"),Pt=E(window,"beforeunload"),jt=E(document,Nt).pipe(k((()=>!document[St]))).pipe($(At.pipe(k((()=>!0))),Tt.pipe(k((()=>!1))),Rt.pipe(k((()=>!0))),Ot.pipe(k((()=>!1))),Pt.pipe(k((()=>!1)))),x());function It(e){class t extends Error{constructor(e){super(`This feature requires a browser, such as Google Chrome or Firefox, that supports ${e}.`)}}throw new t(e)}function Lt(e){return new C((t=>e.subscribe((e=>t.next(e)))))}function Dt(){const[e,t]=v.exports.useState(!1);return v.exports.useEffect((()=>V(t))),e?y.createElement("div",{className:"business-indicator"},y.createElement(ht,{name:"circle-notch",className:"business-indicator--icon"})):null}function qt({language:e,value:t,gap:n,readonly:r,autofocus:s,onChange:o}){const i=v.exports.createRef(),a=S(),[c,l]=v.exports.useState(!0);return v.exports.useEffect((()=>{a&&i.current&&a.editor.colorizeElement(i.current,{theme:"vs-dark"})}),[a,i.current]),c?y.createElement("pre",{className:"mobile-fallback mobile-fallback--code",onClick:()=>l(!1)},y.createElement("code",{ref:i,lang:e,"data-lang":e},t)):y.createElement("textarea",{ref:e=>null==e?void 0:e.style.setProperty("--toolbar-height",`${n||0}px`),className:"mobile-fallback mobile-fallback--textarea",defaultValue:t,readOnly:r,autoFocus:s,autoComplete:"",onChange:e=>o(e.target.value)})}function Ft({value:e,ext:t,gap:n,readonly:r,onChange:s}){const o=S(),[i]=tt("rulers"),[l]=tt("tabSize"),[u]=tt("wordWrap"),[h]=tt("renderIndentGuides"),d=e.split("\n").length,{extension:m}=Re(e),p=function(e){if(!o)return null;const t=o.languages.getLanguages().find((t=>{var n;return null==(n=t.extensions)?void 0:n.includes(e)}));return null==t?void 0:t.id}(t||m)||"markdown";return I?y.createElement(qt,c(a({},{gap:n,language:p,value:e,readonly:r,onChange:s}),{autofocus:!0})):y.createElement(N,{className:"editor",height:n?`calc(100vh - ${n}`:"100vh",theme:"vs-dark",language:p,value:e,options:(g="markdown"===p,{contextmenu:!1,minimap:{enabled:d>100},readOnly:r,renderIndentGuides:h,renderLineHighlight:"none",rulers:i,tabSize:l,wordBasedSuggestions:!g,wordWrap:u?"on":"off","semanticHighlighting.enabled":!0}),onChange:s,onMount:e=>e.focus()});var g}function Mt(e){const{title:t,content:n,ext:r,gap:s}=e,o=function(e){return"readonly"in e}(e)||!1,i=d(),l=d(),u=w(),h=tt("autosave")[0]||0,[m,p]=function(e,t){const[n]=v.exports.useState([]);return v.exports.useEffect((()=>{void 0!==t&&n.push(t)}),[]),[n,function(t){n.unshift(t),n.length>e&&(n.length=e)}]}(5,n),[g,f]=v.exports.useState(!1),[b,E]=v.exports.useState(n),x=pt(1e3*h,(()=>{0!==h&&i()}));if(ct("save",S),v.exports.useEffect((()=>{document.title=`${t}  ✏️  Pensieve`}),[t]),v.exports.useEffect((()=>{if(Ut(e)&&e.saveOnNavigation)return u.listen((()=>i()))})),v.exports.useEffect((()=>{m.includes(n)||(f(!1),E(n))}),[n]),v.exports.useEffect((()=>{if(!g)return;const e=jt.subscribe((e=>{e||l()}));return()=>e.unsubscribe()})),null==b)return y.createElement(Je,null);const C=Lt(l).pipe(k((()=>({urgent:!0}))));return Lt(i).pipe(A(100),$(C)).subscribe((e=>g&&S(e||{}))),y.createElement("div",null,y.createElement(Ft,c(a({},{ext:r,gap:s,value:b,readonly:o}),{onChange:function(t=""){Ut(e)||Ht();f(t!==n),E(t),e.onChange&&e.onChange(t),x.restart()}})),y.createElement(Dt,null));function S({urgent:t=!1}={}){Ut(e)||Ht(),x.stop(),p(b);const n=function(e){const t=e.replace(/ +\n| +$/g,"\n");if("\n"===t[t.length-1])return t;return`${t}\n`}(b);return p(n),e.onSave(n,{urgent:t})}}function Ut(e){return"onSave"in e}function Ht(){throw new Error("How the fuck did you get here???")}function zt(){const{noteId:e}=T(),t=Be(),[n,{loading:r,draft:s}]=vt(e),[o,i]=function(e){const t=Qe(),[n,r]=v.exports.useState(!0),[s,o]=v.exports.useState("");return v.exports.useEffect((()=>{o(""),n||r(!0);const s=t.note(e);return s.read().then(i),s.onContentChange(i)}),[e]),[s,function(n,s){r(!0),t.note(e).write(n,s)},n];function i(e){e!==s&&o(e||""),n&&r(!1)}}(e);return r?y.createElement(Je,null):n?y.createElement(Mt,{key:n.id,title:n.title,content:o,saveOnNavigation:!0,onChange:s,onSave:i}):(console.error(`Note ${e} not found`),t.goRoot(),null)}function _t(e){const[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState("");return v.exports.useEffect((()=>{const t=()=>e.read().then((e=>s(e))).finally((()=>n(!1)));return t(),e.onChange(t)}),[]),[r,function(t,n){if(!function(e){try{return Ce(e),!0}catch(t){return!1}}(t))return alert("Invalid JSON");e.write(t,n)},t]}function Gt(){const e=Qe(),[t,n]=v.exports.useState(0),[r,s,o]=_t(e.settings),[i,c,u]=_t(e.shortcuts),h=[{title:"Settings",content:r,loading:o,onSave:s},{title:"Shortcuts",content:i,loading:u,onSave:c},{title:"Default settings",content:xe(Oe),loading:!1,readonly:!0},{title:"Default shortcuts",content:xe(je),loading:!1,readonly:!0}],d=h[t],{loading:m}=d,p=l(d,["loading"]);return y.createElement("div",{className:"settings-editor"},y.createElement("nav",null,h.map(((e,t)=>y.createElement("div",{key:e.title,className:"tab",onClick:()=>n(t)},e.title)))),m?y.createElement(Je,null):y.createElement(Mt,a({key:p.title,gap:"33px",ext:".json"},p)))}function Wt(){const e=Be();return ct("settings",(()=>e.goSettings())),y.createElement(y.Fragment,null,y.createElement(R,{path:e.create,component:Ct}),y.createElement(R,{path:e.settings,component:Gt}),y.createElement(R,{path:e.note,component:zt}))}const Bt=encodeURIComponent,Vt=decodeURIComponent;function Jt(e,t={}){const n=Object.entries(t).map((([e,t])=>`${Bt(e)}=${Bt(t)}`)).join("&");return n.length?`${e}?${n}`:e}function Kt(e){const[,t]=e.split("?");return t?Object.fromEntries(t.split("&").map((e=>{const[t,n]=e.split("=");return[Vt(t),Vt(n)]}))):{}}class Qt{constructor(e){this.rest=new oe(e)}async fetchCurrentUsername(){return(await this.rest.GET("/user")).login}}const Xt="localhost"===location.hostname,Yt=new class{constructor(e){this.requestState=new p("notes.gh-state",{default:"init",version:1}),this.auth=new p("notes.gh-token",{default:null,version:1}),this.clientId=e.clientId,this.scope=e.scope,this.redirectUri=e.redirectUri,this.endpoint=e.endpoint}get token(){return this.auth.cache}get headers(){return{Authorization:`token ${this.token}`,Accept:"application/vnd.github.v3+json"}}get state(){return this.requestState.cache}requestGithubAuthorization(){const e=Math.random().toString().substr(2),t=Jt("https://github.com/login/oauth/authorize",{client_id:this.clientId,scope:this.scope,redirect_uri:this.redirectUri,state:e});this.requestState.set(e),location.replace(t)}async processGithubAuthCode(e,t){if(t&&t!==this.state)throw new Error(`Request state do not match: "${t}" - "${this.state}`);e&&this.requestState.reset();const n=await this.requestAccessToken(e,t),{access_token:r}=Kt(`/?${n}`);return this.auth.set(r),r}requestAccessToken(e,t){const n=Jt(this.endpoint,{redirect_uri:this.redirectUri,state:t,code:e});return X(n)}}({scope:"repo gist",endpoint:"https://pensieve.amatiasq.com/auth",clientId:Xt?"c55d2c46c215f9a4c3cb":"09580e62d66243b6b09d",redirectUri:Xt?location.origin:"https://pensieve.amatiasq.com/"}),Zt=new p("notes.gh-user",{default:null,version:1});function en(){const{code:e,state:t}=Kt(location.toString()),[n,r]=v.exports.useState(Yt.token&&Zt.cache?{token:Yt.token,username:Zt.cache}:null);return e?(history.replaceState(null,document.title,location.pathname),async function(e,t){const n=await Yt.processGithubAuthCode(e,t),r=new Qt(n),s=await r.fetchCurrentUsername();return Zt.set(s),{token:n,username:s}}(e,t).then(r),{}):n||(Yt.requestGithubAuthorization(),{})}function tn(){const[e,t]=v.exports.useState(null),{token:n,username:r}=en(),s=Be(),[o,i]=v.exports.useState(s.getPageName());return v.exports.useEffect((()=>{n&&r&&async function(e,t,n){const r=new ae(e,t,n);if(navigator.onLine){const e=r.createIfNecessary("Database for notes",!0).catch((()=>!1));await e&&window.location.reload()}const s=new me(f.createInstance({name:n})),o=new ge(r),i=new be(o),a=new fe(new de(s,5,"local"),new de(i,30,"remote"));return new _e(a)}(n,r,"pensieve-data").then(t)}),[n]),v.exports.useEffect((()=>s.onNavigate((e=>i(e.getPageName()))))),e?y.createElement(Ke.Provider,{value:e},y.createElement("div",{className:`app page-${o}`},y.createElement(xt,null),y.createElement("main",null,y.createElement(Wt,null)))):y.createElement(Je,null)}const nn=document.getElementById("app-container");if(!nn)throw new Error("Missing container element");var rn;rn=nn,O.exports.render(y.createElement(P,null,y.createElement(tn,null)),rn),z((e=>{e?nn.classList.add("is-virtual-keyboard-open"):nn.classList.remove("is-virtual-keyboard-open")})),function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r}=e;let s,o;if("serviceWorker"in navigator){s=new u("/sw.js",{scope:"/"}),s.addEventListener("activated",(e=>{e.isUpdate||null==r||r()}));{const e=()=>{null==n||n()};s.addEventListener("waiting",e),s.addEventListener("externalwaiting",e)}s.register({immediate:t}).then((e=>o=e))}}({onNeedRefresh(){alert("New version downloaded. Please refresh the page")},onOfflineReady(){console.log("📡 Offline ready")}});
