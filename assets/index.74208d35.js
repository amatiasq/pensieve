var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,a=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&i(e,n,t[n]);if(r)for(var n of r(t))o.call(t,n)&&i(e,n,t[n]);return e},c=(e,r)=>t(e,n(r)),l=(e,t)=>{var n={};for(var i in e)s.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&r)for(var i of r(e))t.indexOf(i)<0&&o.call(e,i)&&(n[i]=e[i]);return n};import{v as u,n as h,e as d,u as m,S as p,C as g,l as f,a as w,R as y,r as v,L as b,f as E,m as k,b as $,d as x,O as C,c as S,g as N,h as A,U as T,i as R,j as O,k as P,o as j,p as I,q as L,B as D}from"./vendor.180e8d2c.js";const M=navigator.userAgent||navigator.vendor||window.opera,q=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(M)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(M.substr(0,4)),F=(e,t)=>e.w===t.w&&e.h===t.h,z=(e,t)=>e.w===t.w&&e.h>t.h,U={w:window.innerWidth,h:window.innerHeight};let H={w:window.innerWidth,h:window.innerHeight},_={w:window.innerWidth,h:window.innerHeight},G=!1;const W=d(),B=W.subscribe;function V(e){G!==e&&(G=e,W(e))}q&&window.addEventListener("resize",(()=>{H=_,_={w:window.innerWidth,h:window.innerHeight},(F(_,U)&&z(_,H)||F(H,U)&&z(H,_))&&V(!1)}));const J=new Set;let K=!1;const Q=d(),X=Q.subscribe;function Y(e){const t=function(){const e={};return J.add(e),Z(),()=>{J.delete(e),Z()}}();return e.finally(t)}function Z(){const e=Boolean(J.size);e!==K&&(K=e,Q(e))}function ee(e,t={}){const n="body"in t&&"string"!=typeof t.body?JSON.stringify(t.body):t.body,r=c(a({},t),{body:n});return Y(fetch(e,r).then((e=>Promise.all([e,e.text()]))).then((([t,n])=>(function(e,t,n){const r=Math.floor(e/100);let s=re[e];if(console.debug(`HTTP[${e} ${s}]: ${t}`),r<4)return;s||(4===r?s="Unknown client error":5===r&&(s="Unknown server error"));throw new ne(e,s||"Unknown status",n)}(t.status,e,n),function(e){const t=e.headers.get("content-type");return!!t&&t.toLowerCase().includes("application/json")}(t)?JSON.parse(n):n))))}const te=(e,t=null,n={})=>ee(e,a({method:"POST",body:t},n));class ne extends Error{constructor(e,t,n){super(`${e}: ${t}`),this.status=e,this.body=n}}const re={100:"Continue",101:"Switching Protocol",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"unused",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};function se(e){const t=`https://api.github.com${e}`,n=`p=${Date.now()}`;return t.includes("?")?`${t}&${n}`:`${t}?${n}`}function oe(e){return{Authorization:`token ${e}`}}class ie{constructor(e){this.token=e}send(e,t){const n={query:this.buildQuery(e,t),variables:t},r=oe(this.token);return te(se("/graphql"),n,{headers:r}).then((e=>{const{errors:t}=e;return t&&console.error("GraphQL errors:",t),e}))}buildQuery(e,t){const n=Object.keys(t);if(!n.length)return`query {${e}}`;return`query(${n.map((e=>`$${e}: String!`)).join(", ")}) {${e}}`}}var ae,ce;(ce=ae||(ae={})).Json="application/vnd.github.v3+json",ce.Raw="application/vnd.github.v3.raw",ce.Html="application/vnd.github.v3.html";class le{constructor(e){this.token=e}GET(e,t){return((e,t={})=>ee(e,t))(se(e),this.withAuth(t))}DELETE(e){return((e,t={})=>ee(e,a({method:"DELETE"},t)))(se(e),this.withAuth())}PUT(e,t){return((e,t=null,n={})=>ee(e,a({method:"PUT",body:t},n)))(se(e),t,this.withAuth())}POST(e,t){return te(se(e),t,this.withAuth())}PATCH(e,t){return((e,t=null,n={})=>ee(e,a({method:"PATCH",body:t},n)))(se(e),t,this.withAuth())}withAuth({mediaType:e=ae.Json}={}){return{headers:c(a({},oe(this.token)),{Accept:e})}}}const ue={has_issues:!1,has_projects:!1,has_wiki:!1,auto_init:!0,allow_merge_commit:!0,allow_squash_merge:!1,allow_rebase_merge:!1,delete_branch_on_merge:!1,has_downloads:!1,is_template:!1};class he{constructor(e,t,n){this.token=e,this.owner=t,this.name=n,this.commiting=!1,this.branch="main",this.rest=new le(e),this.gql=new ie(e)}get url(){return`/repos/${this.owner}/${this.name}`}get isCommiting(){return this.commiting}exists(){return this.rest.GET(this.url).then((()=>!0),(()=>!1))}async create(e,t){try{await this.rest.POST("/user/repos",a({name:this.name,description:e,homepage:"",private:t,visibility:t?"private":"public"},ue))}catch(n){throw console.error(n),n}}async createIfNecessary(e,t){return!(await this.exists())&&(await this.create(e,t),!0)}async readDir(e){const t=e.replace(/^\*|\*$/g,""),{data:{repository:{files:n}}}=await this.gql.send("\n    repository(owner: $owner, name: $repo) {\n      files: object(expression: $path) {\n        ... on Tree {\n          entries {\n            path\n            object {\n              ... on Blob {\n                text\n              }\n            }\n          }\n        }\n      }\n    }\n  ",this.getFileVars(t));return n?n.entries.map((e=>[e.path,e.object.text])):[]}async getReadme(){return this.rest.GET(`${this.url}/readme`,{mediaType:ae.Raw})}async readFile(e){const t=await this.rest.GET(`${this.url}/contents/${e}`,{mediaType:ae.Raw});if(Array.isArray(t))throw new Error(`${this.url}/${e} is a directory`);return t}async writeFile(e,t,n){await this.rest.PUT(`${this.url}/contents/${e}`,{message:n,content:t})}commit(e,t,n=!1){const{owner:r,name:s,branch:o,token:i}=this,a={token:i,owner:r,repo:s,branch:o,files:t,message:e};return this.commiting=!0,te("https://pensieve.amatiasq.com/commit",a,{keepalive:n}).finally((()=>this.commiting=!1))}async readFileCool(e,t){return this.gql.send(function(e){return`\n    repository(owner: $owner, name: $repo) {\n      object(expression: $path) {\n        ... on Blob {\n          ${e}\n        }\n      }\n    }\n  `}(t),this.getFileVars(e)).then((e=>{var t;return null==(t=e.data.repository.file)?void 0:t.text}))}getFileVars(e){return{owner:this.owner,repo:this.name,path:`${this.branch}:${e}`}}}const de={},me=m.v4();function pe(e){const t=d();de[e]=t;return[t=>{setTimeout((()=>postMessage({id:me,type:e,data:t},location.origin)),10)},t.subscribe]}function ge(e){return JSON.stringify(e,null,2)}function fe(e){const t=e.replace(/[^:]\/\/[^\n]+\n/g,"");try{return JSON.parse(t)}catch(n){const[e]=n.message.split(/\s/g).reverse();throw console.warn(`Error in JSON (${n.message}):\n${t.substr(e-100,200)}`),n}}function we(e=new Date){return`${e.getFullYear()}-${ve(e.getMonth()+1)}-${ve(e.getDate())} ${ve(e.getHours())}:${ve(e.getMinutes())}:${ve(e.getSeconds())}`}function ye(e){return new Date(e)}function ve(e){return e<10?`0${e}`:`${e}`}function be(e,t){return(null!=e&&null!=t||e===t)&&ge(e)===ge(t)}function Ee(e){const t=e.trim(),n=t.indexOf("\n"),r=-1===n?t:t.substr(0,n),s=function(e){const t=e.match(/(\.\w+)+$/);return t?t[0]:".md"}(r),o=function(e,t){const n=function(e){const t=function(e){return{".sql":"--",".md":"#",".sh":"#",".js":"//",".ts":"//",".cs":"//",".fs":"//"}[e]||"//"}(e);return new RegExp(`^\\s*(${t})+`)}(t);return e.trim().replace(n,"").trim()}(r,s),[i,a]=o.split("/").reverse().map((e=>e.trim()));return{title:i,group:a,extension:s,content:e}}window.addEventListener("message",(e=>{const t=de[e.data.type];"function"==typeof t&&(console.debug(`🚎 ${e.data.type}`,e.data.data),t(e.data.data))}));const ke={autosave:5,reloadIfAwayForSeconds:5,renderIndentGuides:!1,rulers:[],sidebarVisible:!0,sidebarWidth:400,starNewNotes:!0,tabSize:2,wordWrap:!0,highlight:{"~~[^~]*~~":"#505050","@(\\w|-)+":"#6fb9ef"},links:{"\\[(\\w+/\\w+)]":"https://github.com/$1"}};function $e(e,t){return ge(e)===ge(t)}const xe={"CTRL+TAB":"goBack","CTRL+SHIFT+TAB":"goForward","ALT+N":"toggleWordWrap","CMD+S":"save","CMD+,":"settings","CMD+B":"hideSidebar","CMD+W":"goHome","CMD+N":"newNote","CMD+SHIFT+E":"clearFilter","CTRL+S":"save","CTRl+,":"settings","CTRL+B":"hideSidebar","CTRL+W":"goHome","CTRL+N":"newNote"};function Ce(e,t,n,r=(()=>!0)){let s=!1,o=!1;return new Promise(((i,a)=>{t.finally((()=>o=!0)).then((e=>{s?n(e):i(e)}),(e=>{s&&a(e)})),e.then((e=>{r(e)&&(s=!0,i(e))}),(e=>{s=!0,o&&a(e)}))}))}function Se(e,t){return{urgent:e&&e.urgent||!1,reason:e&&e.reason||t}}class Ne{constructor(e,t,n){this.store=e,this.key=t,this.defaultValue=n}get isCached(){return this.store.localHas(this.key)}read(){return this.store.read(this.key).then((e=>e||this.defaultValue),(()=>this.defaultValue))}readAsap(e){const t=e=>e||this.defaultValue;return Ce(this.store.readLocal(this.key).then(t),this.store.readRemote(this.key).then(t),e)}write(e,t){const n=Se(t,`Write ${this.key}`);return this.store.write(this.key,e,n)}delete(e){const t=Se(e,`Delete ${this.key}`);return this.store.delete(this.key,t)}}class Ae extends Ne{constructor(e,t,n){super(e,t,ge(n)),this.defaultJson=n;const[r,s]=pe(`json:changed:${t}`);this.emitChange=r,this.onChange=s}get(){return this.read().then((e=>e?fe(e):this.defaultJson)).catch((()=>this.defaultJson))}set(e,t){const n=ge(e),r=Se(t,`Set ${this.key}`);return this.write(n,r)}async write(e,t){this.emitChange(fe(e)),await super.write(e,t)}}const Te=()=>{},Re=new Map;class Oe{constructor(e,t,n){this.id=e,this.meta=t,this.content=n;const[r,s]=pe(`note:title:${e}`),[o,i]=pe(`note:deleted:${e}`),[a,c]=pe(`note:changed:${e}`),[l,u]=pe(`note:content-changed:${e}`);if(Re.has(e))throw new Error(`Created RemoteNote twice with same id: ${e}`);this.emitChange=a,this.emitContentChange=l,this.emitDelete=o,this.emitDraft=r,this.onChange=c,this.onContentChange=u,this.onDelete=i,this.onDraft=s}get title(){const e=this.get();return e?e.title:"(unknown)"}get hasCachedContent(){return Promise.resolve(!0)}getCache(){return Re.get(this.id)||null}get(){return this.getCache()}async delete(e){const t=Se(e,`Delete note "${this.title}"`);await Promise.all([this.meta.delete(t).catch(Te),this.content.delete(t).catch(Te)]),this.emitDelete()}draft(e){const t=this.getCache();if(!t)return;const{title:n,group:r}=Ee(e);this.emitDraft(c(a({},t),{title:n,group:r}))}async read(){localStorage.getItem("URGENT_SAVE")===this.id&&(localStorage.removeItem("URGENT_SAVE"),await new Promise((e=>setTimeout(e,500))));const e=await this.content.readAsap((e=>{this.updateFromContent(e),this.emitContentChange(e)}));return e&&this.updateFromContent(e),e}async write(e,t){t&&t.urgent&&localStorage.setItem("URGENT_SAVE",this.id);const{title:n}=Ee(e),r=Se(t,`Update note "${this.title}"${n!==this.title?` renamed "${n}"`:""}`);await Promise.all([this.updateFromContent(e,r),this.content.write(e,r)]),this.emitContentChange(e)}setGroup(e,t){const n=Se(t,`Add note to group "${e}"`);return this.update((t=>c(a({},t),{group:e})),n)}toggleFavorite(e){const t=Se(e,`Toggle "${this.title}" favorite`);return this.update((e=>c(a({},e),{favorite:!e.favorite})),t)}async push(e){const{id:t}=this;if(e.id!==t)throw new Error(`Pushing note with id ${e.id} into RemoteNote with id ${t}`);const n=!be(this.getCache(),e);Re.set(t,e),n&&this.emitChange(e)}async update(e,t){const n=await this.meta.get(),r=e(n),s=we();return be(c(a({},n),{modified:s}),c(a({},r),{modified:s}))||(await this.meta.set(r,t),this.emitChange(r)),r}async updateFromContent(e,t){const{title:n,group:r}=Ee(e),s=await this.update((e=>c(a({},e),{title:n,group:r,modified:we()})),t);return Re.set(this.id,s),s}}const Pe=e=>`meta/${e}.json`,je=e=>`note/${e}`,Ie=e=>e.trim().replace(/,$/,"");function Le(e){const{group:t,title:n}=Ee(e);return{id:m.v4(),title:n,group:t,favorite:!0,created:we(),modified:we()}}class De extends class{constructor(e){this.store=e,this.notes=new Map,this.settings=new Ae(this.store,"settings.json",ke),this.shortcuts=new Ae(this.store,"shortcuts.json",xe);const[t,n]=pe("notes-created");this.emitNotesCreate=t,this.onNotesCreated=n}async all(){const e="meta/*",t=e=>t=>(console.log(`Notes found in ${e}`,Object.keys(t).length),t);return Ce(this.store.readAllLocal(e).then(t("local")),this.store.readAllRemote(e).then(t("remote")),(e=>this.synchronize(e)),(e=>Boolean(Object.keys(e).length))).then((e=>Object.values(e).map((e=>{const t=fe(Ie(e));return this.updateRemote(t.id,t),t}))))}synchronize(e){const t=[],n=new Set(...this.notes.keys());for(const[,r]of Object.entries(e)){const e=fe(Ie(r)),s=n.delete(e.id);this.note(e.id).push(e),s||t.push(e)}t.length&&this.emitNotesCreate(t);for(const r of n)this.store.deleteLocal(Pe(r)),this.store.deleteLocal(je(r))}note(e){return this.notes.has(e)?this.notes.get(e):this.createRemote(e,c(a({},Le("")),{id:e}))}create(e){const t=Le(e),{id:n}=t,r=this.createRemote(n,t),s=`Create note "${t.title}"`;return Promise.all([this.store.write(Pe(n),ge(t),{reason:s}),r.write(e,{reason:s})]),this.emitNotesCreate([t]),r}updateRemote(e,t){if(!this.notes.get(e))return this.createRemote(e,t);const n=this.notes.get(e);return n.push(t),n}createRemote(e,t){const n=new Oe(e,new Ae(this.store,Pe(e),t),new Ne(this.store,je(e),""));return this.notes.set(e,n),n.push(t),n}}{constructor(e,...t){super(...t),this.username=e}}let Me=0;const qe=Boolean(localStorage.getItem("debug"));function Fe(e,t,n){if(!qe)return;const r=e.constructor.name;t.forEach((t=>{const s=e[t];e[t]=(...o)=>{const i="  ".repeat(Me++),a=n?` [${n}]`:"";console.debug(`${i}🟢 ${r}.${t}${a}`,o[0]);const c=s.apply(e,o);return console.debug(`${i}🔴 ${r}.${t}${a}`),Me--,c}}))}class ze{constructor(e){this.duration=e,this.data=new Map,this.time=new Map}has(e){const t=this.time.get(e);if(null==t)return!1;const n=(Date.now()-t)/1e3>this.duration;return n&&(this.time.delete(e),this.data.delete(e)),!n}get(e){return this.data.get(e)}set(e,t){this.time.set(e,Date.now()),this.data.set(e,t)}}class Ue{constructor(e,t,n){this.store=e,this.seconds=t,this.readAllCache=new ze(this.seconds),this.cache=new ze(this.seconds),Fe(this,["readAll","read","write","delete"],n)}has(e){return this.store.has(e)}readAll(e){if(this.readAllCache.has(e))return this.readAllCache.get(e);const t=this.store.readAll(e);return this.readAllCache.set(e,t),t}read(e){if(this.cache.has(e))return this.cache.get(e);const t=this.store.read(e);return this.cache.set(e,t),t}write(e,t,n){return this.cache.set(e,Promise.resolve(t)),this.store.write(e,t,n)}delete(e,t){return this.cache.set(e,Promise.resolve(null)),this.store.delete(e,t)}}class He{constructor(e){this.forage=e,this.keys=null,Fe(this,["readAll","read","write","delete"])}async has(e){const t=this.keys||await this.forage.keys();return this.keys||(this.keys=t,setTimeout((()=>this.keys=null),3e3)),t.includes(e)}async readAll(e){const t=function(e){const t=e.startsWith("*")?"":"^",n=e.endsWith("*")?"":"$",r=e.replace(/^\*|\*$/g,"");return new RegExp(`${t}${r}${n}`)}(e),n=(await this.forage.keys()).filter((e=>t.test(e))).map((async e=>[e,await this.read(e)])),r=(await Promise.all(n)).filter((e=>e[1]));return Object.fromEntries(r)}read(e){return this.forage.getItem(e)}async write(e,t){await this.forage.setItem(e,t)}async delete(e){await this.forage.removeItem(e)}}class _e{constructor(e){this.repo=e,this.scheduler=new p(100,(()=>this.push())),this.pending=[],Fe(this,["readAll","read","write","delete"])}has(e){throw new Error("Do not use me")}async readAll(e){const t=await this.repo.readDir(e);return Object.fromEntries(t)}read(e){return this.repo.readFile(e)}write(e,t,n){const{urgent:r,reason:s}=Se(n,`Update ${e}`);return this.commit(s,{[e]:t},r)}async delete(e,t){const{urgent:n,reason:r}=Se(t,`Remove ${e}`);await this.commit(r,{[e]:null},n)}commit(e,t,n){if(!Object.keys(t).length)throw new Error("NO FILES TO COMMIT");return new Promise(((r,s)=>{this.pending.push({message:e,files:t,resolve:r,reject:s}),n?this.push(!0):this.scheduler.restart()}))}push(e=!1){if(this.repo.isCommiting)return void this.scheduler.restart();if(!this.pending.length)return;const t=[...this.pending];this.pending.length=0;const n=t.reduce(((e,t)=>a(a({},e),t.files)),{}),r=(s=t.map((e=>e.message)),Array.from(new Set(s)));var s;const o=r.length>1?`Multiple:\n- ${r.join("\n- ")}`:r[0];this.repo.commit(o,n,e).then((()=>t.forEach((e=>e.resolve()))),(e=>t.forEach((t=>t.reject(e)))))}}class Ge{constructor(e,t){this.local=e,this.remote=t,Fe(this,["readAll","read","write","delete"])}has(e){throw new Error("Do not use me")}localHas(e){return this.local.has(e)}readAll(e){return this.readAllRemote(e).catch((()=>this.readAllLocal(e)))}async readAllRemote(e){const[t,n]=await Promise.all([this.local.readAll(e),this.remote.readAll(e)]),r=Object.keys(t).filter((e=>!(e in n))).map((e=>this.local.delete(e))),s=Object.keys(n).filter((e=>n[e]!==t[e])).map((e=>this.local.write(e,n[e])));return Promise.all(s).then((()=>console.log(`${r.length} notes removed from local and ${s.length} updated`))),n}readAllLocal(e){return this.local.readAll(e)}read(e){return this.remote.read(e).then((t=>this.updateOffline(e,t)),(()=>this.local.read(e)))}readRemote(e){return this.remote.read(e).then((t=>this.updateOffline(e,t)))}readLocal(e){return this.local.read(e)}async write(e,t,n){await Promise.race([this.local.write(e,t,n),this.remote.write(e,t,n)])}async delete(e,t){await Promise.race([this.local.delete(e,t),this.remote.delete(e,t)])}deleteLocal(e){this.local.delete(e)}updateOffline(e,t){return null==t?this.local.delete(e):this.local.write(e,t),t}}class We extends Error{}const Be=new g("pensieve.pending-commands",{default:[]}),Ve=e=>Be.set([...Be.cache,e]);class Je{constructor(e){this.remote=e,this.reading=new Map,this.reconnect=new p(1e3,(()=>this.executePending())),window.addEventListener("online",(()=>this.executePending())),Fe(this,["readAll","read","write","delete"])}get isOffline(){return!navigator.onLine}has(e){throw new Error("Do not use me")}readAll(e){return this.rejectIfOffline()||this.remote.readAll(e)}read(e){if(this.reading.has(e))return this.reading.get(e);if(this.isOffline)return Promise.reject((()=>new We));const t=this.remote.read(e);return this.reading.set(e,t),t.finally((()=>this.reading.delete(e)))}write(e,t,n){return this.command("write",[e,t,n])}delete(e,t){return this.command("delete",[e,t])}rejectIfOffline(){if(this.isOffline)return Promise.reject(new We)}command(e,t,n=0){if(this.isOffline)return Ve({method:e,params:t,attempts:n}),Promise.reject(new We);return this.remote[e](...t).catch((r=>{throw Ve({method:e,params:t,attempts:n+1}),this.reconnect.restart(),r}))}executePending(){if(this.isOffline)this.reconnect.restart();else for(const{method:e,params:t,attempts:n}of(()=>{const e=[...Be.cache];return Be.reset(),e})())n<5?this.command(e,t,n):console.warn(`Command ${e} failed ${n} times`,...t)}}Object.assign(window,{localforage:f});class Ke{constructor(e,t){this.history=e,this.path=t,this.root="/",this.create="/new",this.settings="/settings",this.note="/note/:noteId",this.goRoot=()=>this.history.push(this.root),this.goSettings=()=>this.history.push(this.settings),this.toNote=Xe((e=>this.note.replace(":noteId",e))),this.goNote=Xe((e=>this.history.push(this.note.replace(":noteId",e)))),this.isNote=Xe((e=>this.path===this.note.replace(":noteId",e)))}onNavigate(e){return this.history.listen((t=>e(new Ke(this.history,t.pathname))))}getPageName(){if("/"===this.path)return"home";const[,e]=this.path.split("/");return e}}function Qe(){const e=w();return new Ke(e,e.location.pathname)}function Xe(e){return t=>e("string"==typeof t?t:t.id)}function Ye(){return y.createElement("div",{className:"loader"},y.createElement("div",{className:"container"},y.createElement("div",{className:"ripple"}),y.createElement("div",{className:"ripple ripple2"})))}const Ze=v.exports.createContext(null);function et(){return v.exports.useContext(Ze)}function tt(){const e=et(),t=Qe();return()=>{const n=e.create(`${we()}.md\n`);t.goNote(n.id)}}let nt=0;function rt(){const e=et(),[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState([]);return v.exports.useEffect((()=>{t||n(!0),e.all().then(o)}),[]),v.exports.useEffect((()=>{const t=r.map((t=>e.note(t.id))),n=[e.onNotesCreated(i),...t.map((e=>e.onChange(a))),...t.map((e=>{return e.onDelete((t=e.id,()=>{s(r.filter((e=>e.id!==t)))}));var t}))];return()=>n.forEach((e=>e()))}),[r]),[r,t];function o(e){if(i=e,(o=r).length!==i.length||!o.every(((e,t)=>be(e,i[t])))){const t=e.sort(((e,t)=>Number(ye(t.created))-Number(ye(e.created))));s(t)}var o,i;t&&n(!1)}function i(e){const t=e.map((e=>e.id)),n=r.filter((e=>!t.includes(e.id)));o([...e,...n])}function a(e){const{id:t}=e,n=r.findIndex((e=>e.id===t));if(-1===n)throw new Error(`Unknown note updated: ${t}`);o([...r.slice(0,n),e,...r.slice(n+1)])}}const st=new g("pensieve.settings-hook",{version:1});function ot(e){const[t,n,r]=function(){const e=et(),[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState(st.cache||ke);return v.exports.useEffect((()=>(e.settings.get().then(o),e.settings.onChange(o))),[]),[r,async function(t){$e(t,r)||(st.set(t),n(!0),s(t),await e.settings.set(t),n(!1))},{loading:t}];function o(e){$e(e,r)||(st.set(e),s(e)),t&&n(!1)}}(),s=t[e],[,o]=v.exports.useState(s);return v.exports.useEffect((()=>{o(s);const t="boolean"!=typeof s?s:s?1:0;document.documentElement.style.setProperty(`--setting-${e}`,`${t}`)}),[ge(s)]),[s,function(r){ge(s)!==ge(r)&&n(c(a({},t),{[e]:r}))},r]}st.get();const it={Meta:"META",Shift:"SHIFT",Alt:"ALT",Control:"CTRL"},at={" ":"Space"},ct=d(),lt=ct.subscribe;q||document.addEventListener("keydown",(function(e){const t=[];e.metaKey&&t.push("META");e.ctrlKey&&t.push("CTRL");e.altKey&&t.push("ALT");e.shiftKey&&t.push("SHIFT");if(e.key in it)return;const n=function(e){return e in at?at[e]:e}(e.key);ct({key:e.key,keys:[...t.sort(),n],preventDefault:()=>e.preventDefault()})}),!0);const ut={};let ht=!1;function dt(e,t){const n=ut[e],r=et();v.exports.useEffect((()=>(ut[e]=t,()=>{ut[e]=n}))),ht||function(e){let t=mt(xe);const n=e=>t=mt(e);e.shortcuts.get().then(n),e.shortcuts.onChange(n),lt((e=>{const n=e.keys.join("+").toUpperCase();if(e.keys.length>1&&console.log(n),n in t){const r=t[n],s=ut[r]||null;console.log("Shortcut received",{keys:n,commandName:r,command:s}),"function"==typeof s&&(e.preventDefault(),s())}})),ht=!0}(r)}function mt(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>{return[(n=e,n.toUpperCase().replace(/CMD|WINDOWS|WIN/,"META")),t];var n})))}function pt(e){return y.createElement("button",a({type:"button",role:"button"},e))}function gt({name:e,prefix:t="fas",className:n}){const[r,s]=e.includes(" ")?e.split(" "):[t,e];return y.createElement("i",{className:`${r} fa-${s} ${n||""}`})}function ft(e){const t=e,{icon:n,className:r}=t,s=l(t,["icon","className"]),o=`icon-button ${r||""}`;return y.createElement(pt,c(a({},s),{className:o}),y.createElement(gt,{name:n}))}function wt(e){const[t,n]=v.exports.useState(!1),[r,s]=v.exports.useState(e.size),[o,i]=v.exports.useState([0,0]);return y.createElement("div",{className:"resizer",draggable:!0,onDragStart:e=>{n(!0),s(e.clientX),i([0,0])},onDrag:e=>{t&&i([o[1],e.clientX-r])},onDragEnd:()=>{const t=r+o[0];n(!1),s(t),e.onChange(t)}})}function yt(e,t){const[n]=v.exports.useState({callback:t}),[r]=v.exports.useState(new p(e,(()=>n.callback())));return n.callback=t,r}const vt=/\s+/g;class bt{constructor(e){this.clean=Et(e)}fullMatch(e){return Et(e)===this.clean}matches(e){return!this.clean||Et(e).includes(this.clean)}matchesAny(e){return e.filter(Boolean).some((e=>this.matches(e)))}}function Et(e){return e.toLowerCase().replace(vt,"")}function kt({onChange:e}){const t=v.exports.createRef(),[n,r]=v.exports.useState(""),s=yt(50,(()=>e(n?new bt(n):null)));return dt("clearFilter",(()=>o(""))),y.createElement(y.Fragment,null,y.createElement("input",{ref:t,className:"filter-box",type:"text",placeholder:"Filter...",defaultValue:n,onChange:e=>o(e.target.value)}),n?y.createElement(ft,{icon:"times",onClick:()=>o("")}):null);function o(e){t.current&&(t.current.value=e),r(e),s.restart()}}function $t(e){const t=et(),n=t.note(e),[r,s]=v.exports.useState(n.get()),[o,i]=v.exports.useState(!r);return v.exports.useEffect((()=>{const e=n.get();e?a(e):i(!0);const t=[n.onChange(a),n.onDraft(a)];return()=>t.forEach((e=>e()))}),[e]),[r,{loading:o,toggleFavorite:()=>t.note(e).toggleFavorite(),remove:()=>t.note(e).delete(),draft:n=>t.note(e).draft(n)}];function a(e){be(e,r)||s(e),o&&i(!1)}}function xt({id:e}){const t=Qe(),n=v.exports.useContext(Ze).username,[r,{toggleFavorite:s,remove:o}]=$t(e),[i,l]=v.exports.useState(t.isNote(e));if(v.exports.useEffect((()=>t.onNavigate((t=>{const n=t.isNote(e);(i||n)&&l(n)})))),!r)return null;const u=`https://github.com/${n}/pensieve-data/blob/main/note/${r.id}`,h=["note-item",r.favorite?"favorite":"",i?"active":""],d=r.group?{"data-group":r.group}:{},m=y.createElement("a",{target:"_blank",href:u,onClick:e=>e.stopPropagation()},"GH");return y.createElement(b,c(a({className:h.join(" ")},d),{to:t.toNote(r)}),y.createElement("div",{className:"star-part"},y.createElement(ft,{icon:r.favorite?"star":"far star",onClick:function(e){e.preventDefault(),s()}})),y.createElement("h5",{className:"title-part"},r.title),y.createElement("div",{className:"actions-part"},m,y.createElement(ft,{icon:"trash",onClick:function(n){if(!confirm(`Delete ${r.title}?`))return;n.preventDefault(),t.isNote(e)&&t.goRoot();return o()}})))}const Ct=e=>`group-open:${e}`;function St({group:e,notes:t}){const n=e=>t.some((t=>e.isNote(t))),r=(e=>Boolean(localStorage[Ct(e)]))(e),s=Qe(),[o,i]=v.exports.useState(n(s));v.exports.useEffect((()=>s.onNavigate((e=>{const t=n(e);o!==t&&i(t)}))));const a=t.filter((e=>e.favorite)),c=["group",o?"has-active":"",a.length?"has-favorite":""];return y.createElement("details",{className:c.join(" "),"data-group":e,open:r},y.createElement("summary",{className:"group-title",onClick:Nt},y.createElement(gt,{name:"angle-right",className:"icon-button group-caret"}),y.createElement("span",{className:"group-name"},e),a.length?y.createElement(y.Fragment,null,y.createElement("i",{className:"fav-counter"},a.length)," /"):null,y.createElement("i",{className:"counter"},t.length)),y.createElement("ul",{className:"group-content"},t.map((e=>y.createElement(xt,{key:e.id,id:e.id})))))}function Nt(e){const t=e.currentTarget.parentElement,n=t.hasAttribute("open"),r=Ct(t.dataset.group);console.log(`${r}: ${!n}`),n?localStorage.removeItem(r):localStorage.setItem(r,"true")}function At(){const e=tt(),[t,n]=rt(),[r,s]=v.exports.useState(null),o=function(e,t){const[n,r]=v.exports.useState([]),[s,o]=v.exports.useState(0),i=et();if(v.exports.useEffect((()=>{t&&(o(0),r(e.filter((e=>t.matchesAny([e.id,e.title,e.group])))))}),[e,t]),!t)return e;const a=++nt;return setTimeout((async function(){if(a===nt)for(let a=s;a<e.length;a++){const s=e[a];if(n.includes(s))continue;const c=i.note(s.id);if(await c.hasCachedContent){const e=await c.read();if(t.matches(e)){o(a+1),r([...n,s]);break}}}}),10),n}(t,r),[i,c]=ot("sidebarVisible"),[l,u]=ot("sidebarWidth");if(dt("newNote",e),dt("hideSidebar",(()=>c(!i))),!i)return null;const h=r?{"data-filter":!0}:{};return y.createElement("aside",null,y.createElement("h4",{className:"filter"},y.createElement(kt,{onChange:s}),y.createElement(ft,{icon:"plus",onClick:e})),y.createElement("div",a({className:"notes-list"},h),n?y.createElement(Ye,null):function(){const e=new Map,t=[...o.filter((e=>e.favorite)),...o.filter((e=>!e.favorite))];return t.map((t=>{var n;const{group:r}=t;return r?e.has(r)?(null==(n=e.get(r))||n.push(t),null):(e.set(r,[t]),r):t})).filter(Boolean).map((t=>{if("string"!=typeof t)return y.createElement(xt,{key:t.id,id:t.id});const n=t,r=e.get(n);return y.createElement(St,{key:`group/${n}`,group:n,notes:r})}))}()),y.createElement(wt,{size:l,onChange:u}))}function Tt(){const e=tt();return v.exports.useEffect(e,[]),y.createElement(Ye,null)}const{isHidden:Rt,visibilitychange:Ot}=function(){null==document.addEventListener&&qt("Page Visibility API");if(null!=document.hidden)return{isHidden:"hidden",visibilitychange:"visibilitychange"};if(null!=document.msHidden)return{isHidden:"msHidden",visibilitychange:"msvisibilitychange"};if(null!=document.webkitHidden)return{isHidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"};qt("Page Visibility API")}(),Pt=E(window,"pageshow"),jt=E(window,"pagehide"),It=E(window,"freeze"),Lt=E(window,"resume"),Dt=E(window,"beforeunload"),Mt=E(document,Ot).pipe(k((()=>!document[Rt]))).pipe($(Pt.pipe(k((()=>!0))),jt.pipe(k((()=>!1))),It.pipe(k((()=>!0))),Lt.pipe(k((()=>!1))),Dt.pipe(k((()=>!1)))),x());function qt(e){class t extends Error{constructor(e){super(`This feature requires a browser, such as Google Chrome or Firefox, that supports ${e}.`)}}throw new t(e)}function Ft(e){return new C((t=>e.subscribe((e=>t.next(e)))))}function zt(){const[e,t]=v.exports.useState(!1);return v.exports.useEffect((()=>X(t))),e?y.createElement("div",{className:"business-indicator"},y.createElement(gt,{name:"circle-notch",className:"business-indicator--icon"})):null}function Ut(e,t){const n=Object.entries(t).map((([e,t])=>{const n=function(e){const t=new RegExp(e,"g");return e=>{const n=e.getLinesContent(),r=[];let s=0,o=0;for(let i=0;i<n.length;i++){const e=n[i];for(const n of e.matchAll(t)){const e=n[0],t=Array.from(n),a=i,c=n.index,l=new N(a+1,c+1,a+1,c+1+e.length);r.push({text:e,capture:t,row:a,col:c,prevLine:s,prevChar:o,range:l}),s=i,o=n.index}}return r}}(e);return e=>n(e).map((({range:e,capture:n})=>({range:e,url:Ht(t,n)})))}));e.languages.registerLinkProvider("markdown",{provideLinks:e=>({links:n.flatMap((t=>t(e)))})})}function Ht(e,t){const n=e.replace(/\$(\d+)/g,((e,n)=>t[n]||""));return T.parse(n)}S.IMonarchLanguage,A.ITextModel;function _t(e,t,n){if(n&&Ut(e,n),!t)return;const r=[],s=[];let o=0;for(const[i,a]of Object.entries(t)){const e=`autotoken${o}`;s.push([i,e]),r.push({token:e,foreground:a}),o++}!async function(e,t,n){const r=e.languages.getLanguages().find((({id:e})=>e===t));if(!r)throw new Error(`Could not find language ${t}`);const{language:s}=await r.loader(),o=n,{tokenizer:i}=o,a=l(o,["tokenizer"]);for(const[c,l]of Object.entries(i))s.tokenizer.hasOwnProperty(c)||(s.tokenizer[c]=[]),Array.isArray(l)&&s.tokenizer[c].unshift(...l);for(const[c,l]of Object.keys(a))Array.isArray(l)&&(s.hasOwnProperty(c)||(s[c]=[]),s[c].unshift(...l))}(e,"markdown",{tokenizer:{root:s}}),function(e,t,n){e.editor.defineTheme("pensieve",{base:t,inherit:!0,colors:{},rules:n})}(e,"vs-dark",r)}function Gt({language:e,value:t,gap:n,readonly:r,autofocus:s,onChange:o}){const i=v.exports.createRef(),a=R(),[c]=ot("links"),[l]=ot("highlight"),[u,h]=v.exports.useState(!0);return v.exports.useEffect((()=>{a&&_t(a,l,c)}),[a,l,c]),v.exports.useEffect((()=>{a&&i.current&&a.editor.colorizeElement(i.current,{theme:"pensieve"})}),[a,i.current]),u?y.createElement("pre",{className:"mobile-fallback mobile-fallback--code",onClick:()=>h(!1)},y.createElement("code",{ref:i,lang:e,"data-lang":e},t)):y.createElement("textarea",{ref:e=>null==e?void 0:e.style.setProperty("--toolbar-height",`${n||0}px`),className:"mobile-fallback mobile-fallback--textarea",defaultValue:t,readOnly:r,autoFocus:s,autoComplete:"",onChange:e=>o(e.target.value)})}A.BuiltinTheme,A.ITokenThemeRule,S.IMonarchLanguageRule,A.ITokenThemeRule;function Wt({value:e,ext:t,gap:n,readonly:r,onChange:s}){const o=R(),[i]=ot("links"),[l]=ot("rulers"),[u]=ot("tabSize"),[h]=ot("wordWrap"),[d]=ot("highlight"),[m]=ot("renderIndentGuides"),p=e.split("\n").length,{extension:g}=Ee(e),f=function(e){if(!o)return null;const t=o.languages.getLanguages().find((t=>{var n;return null==(n=t.extensions)?void 0:n.includes(e)}));return null==t?void 0:t.id}(t||g)||"markdown";return q?y.createElement(Gt,c(a({},{gap:n,language:f,value:e,readonly:r,onChange:s}),{autofocus:!0})):y.createElement(O,{className:"editor",height:n?`calc(100vh - ${n}`:"100vh",theme:"pensieve",language:f,value:e,options:(w="markdown"===f,{"semanticHighlighting.enabled":!0,automaticLayout:!0,contextmenu:!1,minimap:{enabled:p>100},readOnly:r,renderIndentGuides:m,renderLineHighlight:"none",rulers:l,tabSize:u,wordBasedSuggestions:!w,wordWrap:h?"on":"off"}),onChange:s,beforeMount:e=>_t(e,d,i),onMount:e=>e.focus()});var w}function Bt(e){const{title:t,content:n,ext:r,gap:s}=e,o=function(e){return"readonly"in e}(e)||!1,i=d(),l=d(),u=w(),h=ot("autosave")[0]||0,[m,p]=function(e,t){const[n]=v.exports.useState([]);return v.exports.useEffect((()=>{void 0!==t&&n.push(t)}),[]),[n,function(t){n.unshift(t),n.length>e&&(n.length=e)}]}(5,n),[g,f]=v.exports.useState(!1),[b,E]=v.exports.useState(n),x=yt(1e3*h,(()=>{0!==h&&i()}));if(dt("save",S),v.exports.useEffect((()=>{document.title=`${t}  ✏️  Pensieve`}),[t]),v.exports.useEffect((()=>{if(Vt(e)&&e.saveOnNavigation)return u.listen((()=>i()))})),v.exports.useEffect((()=>{m.includes(n)||(f(!1),E(n))}),[n]),v.exports.useEffect((()=>{if(!g)return;const e=Mt.subscribe((e=>{e||l()}));return()=>e.unsubscribe()})),null==b)return y.createElement(Ye,null);const C=Ft(l).pipe(k((()=>({urgent:!0}))));return Ft(i).pipe(P(100),$(C)).subscribe((e=>g&&S(e||{}))),y.createElement("div",null,y.createElement(Wt,c(a({},{ext:r,gap:s,value:b,readonly:o}),{onChange:function(t=""){Vt(e)||Jt();f(t!==n),E(t),e.onChange&&e.onChange(t),x.restart()}})),y.createElement(zt,null));function S({urgent:t=!1}={}){Vt(e)||Jt(),x.stop(),p(b);const n=function(e){const t=e.replace(/ +\n| +$/g,"\n");if("\n"===t[t.length-1])return t;return`${t}\n`}(b);return p(n),e.onSave(n,{urgent:t})}}function Vt(e){return"onSave"in e}function Jt(){throw new Error("How the fuck did you get here???")}function Kt(){const{noteId:e}=j(),t=Qe(),[n,{loading:r,draft:s}]=$t(e),[o,i]=function(e){const t=et(),[n,r]=v.exports.useState(!0),[s,o]=v.exports.useState("");return v.exports.useEffect((()=>{o(""),n||r(!0);const s=t.note(e);return s.read().then(i),s.onContentChange(i)}),[e]),[s,function(n,s){r(!0),t.note(e).write(n,s)},n];function i(e){e!==s&&o(e||""),n&&r(!1)}}(e);return r?y.createElement(Ye,null):n?y.createElement(Bt,{key:n.id,title:n.title,content:o,saveOnNavigation:!0,onChange:s,onSave:i}):(console.error(`Note ${e} not found`),t.goRoot(),null)}function Qt(e){const[t,n]=v.exports.useState(!0),[r,s]=v.exports.useState("");return v.exports.useEffect((()=>{const t=()=>e.read().then((e=>s(e))).finally((()=>n(!1)));return t(),e.onChange(t)}),[]),[r,function(t,n){if(!function(e){try{return fe(e),!0}catch(t){return!1}}(t))return alert("Invalid JSON");e.write(t,n)},t]}function Xt(){const e=et(),[t,n]=v.exports.useState(0),[r,s,o]=Qt(e.settings),[i,c,u]=Qt(e.shortcuts),h=[{title:"Settings",content:r,loading:o,onSave:s},{title:"Shortcuts",content:i,loading:u,onSave:c},{title:"Default settings",content:ge(ke),loading:!1,readonly:!0},{title:"Default shortcuts",content:ge(xe),loading:!1,readonly:!0}],d=h[t],{loading:m}=d,p=l(d,["loading"]);return y.createElement("div",{className:"settings-editor"},y.createElement("nav",null,h.map(((e,t)=>y.createElement("div",{key:e.title,className:"tab",onClick:()=>n(t)},e.title)))),m?y.createElement(Ye,null):y.createElement(Bt,a({key:p.title,gap:"33px",ext:".json"},p)))}function Yt(){const e=Qe();return dt("settings",(()=>e.goSettings())),y.createElement(y.Fragment,null,y.createElement(I,{path:e.create,component:Tt}),y.createElement(I,{path:e.settings,component:Xt}),y.createElement(I,{path:e.note,component:Kt}))}const Zt=encodeURIComponent,en=decodeURIComponent;function tn(e,t={}){const n=Object.entries(t).map((([e,t])=>`${Zt(e)}=${Zt(t)}`)).join("&");return n.length?`${e}?${n}`:e}function nn(e){const[,t]=e.split("?");return t?Object.fromEntries(t.split("&").map((e=>{const[t,n]=e.split("=");return[en(t),en(n)]}))):{}}class rn{constructor(e){this.rest=new le(e)}async fetchCurrentUsername(){return(await this.rest.GET("/user")).login}}const sn="localhost"===location.hostname,on=new class{constructor(e){this.requestState=new g("notes.gh-state",{default:"init",version:1}),this.auth=new g("notes.gh-token",{default:null,version:1}),this.clientId=e.clientId,this.scope=e.scope,this.redirectUri=e.redirectUri,this.endpoint=e.endpoint}get token(){return this.auth.cache}get headers(){return{Authorization:`token ${this.token}`,Accept:"application/vnd.github.v3+json"}}get state(){return this.requestState.cache}requestGithubAuthorization(){const e=Math.random().toString().substr(2),t=tn("https://github.com/login/oauth/authorize",{client_id:this.clientId,scope:this.scope,redirect_uri:this.redirectUri,state:e});this.requestState.set(e),location.replace(t)}async processGithubAuthCode(e,t){if(t&&t!==this.state)throw new Error(`Request state do not match: "${t}" - "${this.state}`);e&&this.requestState.reset();const n=await this.requestAccessToken(e,t),{access_token:r}=nn(`/?${n}`);return this.auth.set(r),r}requestAccessToken(e,t){const n=tn(this.endpoint,{redirect_uri:this.redirectUri,state:t,code:e});return te(n)}}({scope:"repo gist",endpoint:"https://pensieve.amatiasq.com/auth",clientId:sn?"c55d2c46c215f9a4c3cb":"09580e62d66243b6b09d",redirectUri:sn?location.origin:"https://pensieve.amatiasq.com/"}),an=new g("notes.gh-user",{default:null,version:1});function cn(){const{code:e,state:t}=nn(location.toString()),[n,r]=v.exports.useState(on.token&&an.cache?{token:on.token,username:an.cache}:null);return e?(history.replaceState(null,document.title,location.pathname),async function(e,t){const n=await on.processGithubAuthCode(e,t),r=new rn(n),s=await r.fetchCurrentUsername();return an.set(s),{token:n,username:s}}(e,t).then(r),{}):n||("/halt"===location.pathname||on.requestGithubAuthorization(),{})}function ln(){const[e,t]=v.exports.useState(null),{token:n,username:r}=cn(),s=Qe(),[o,i]=v.exports.useState(s.getPageName());return v.exports.useEffect((()=>{n&&r&&async function(e,t,n){const r=new he(e,t,n);if(navigator.onLine){const e=r.createIfNecessary("Database for notes",!0).catch((()=>!1));await e&&window.location.reload()}const s=new He(f.createInstance({name:n})),o=new _e(r),i=new Je(o),a=new Ge(new Ue(s,5,"local"),new Ue(i,30,"remote"));return new De(t,a)}(n,r,"pensieve-data").then(t)}),[n]),v.exports.useEffect((()=>s.onNavigate((e=>i(e.getPageName()))))),e?y.createElement(Ze.Provider,{value:e},y.createElement("div",{className:`app page-${o}`},y.createElement(At,null),y.createElement("main",null,y.createElement(Yt,null)))):y.createElement(Ye,null)}const un=document.getElementById("app-container");if(!un)throw new Error("Missing container element");var hn;hn=un,L.exports.render(y.createElement(D,null,y.createElement(ln,null)),hn),B((e=>{e?un.classList.add("is-virtual-keyboard-open"):un.classList.remove("is-virtual-keyboard-open")})),function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r}=e;let s,o;if("serviceWorker"in navigator){s=new u("/sw.js",{scope:"/"}),s.addEventListener("activated",(e=>{e.isUpdate||null==r||r()}));{const e=()=>{null==n||n()};s.addEventListener("waiting",e),s.addEventListener("externalwaiting",e)}s.register({immediate:t}).then((e=>o=e))}}({onNeedRefresh(){alert("New version downloaded. Please refresh the page")},onOfflineReady(){console.log("📡 Offline ready")}});
